# @package _global_
# TBFM (Temporal Basis Function Model) configuration

tbfm:
  module:
    _target_: tbfm.tbfm.TBFM
    in_dim: ${latent_dim}  # By default TBFM lives in a latent space.
    runway: ${data.runway}
    num_bases: 20
    trial_len: ${data.y_len}
    latent_dim: 16  # This is basis generator latent dim
    basis_depth: 3
    covariate_dim: ${covariate_dim}
    zscore: false
    use_meta_learning: true
    proj_meta_dim: 32
    is_basis_residual: ${meta.is_basis_residual}
    basis_residual_rank: ${meta.basis_residual_rank}
    residual_mlp_hidden: ${meta.residual_mlp_hidden}
    basis_gen_dropout: 0.3
    embed_dim_rest: 3
    embed_dim_stim: 15
    use_hypernetwork: ${meta.use_hypernetwork}
    hypernet_context_dim: ${meta.hypernetwork.context_dim}
    hypernet_context_encoder_hidden: ${meta.hypernetwork.context_encoder_hidden}
    hypernet_param_generator_hidden: ${meta.hypernetwork.param_generator_hidden}
    hypernet_use_attention: ${meta.hypernetwork.use_attention}
    hypernet_num_attention_heads: ${meta.hypernetwork.num_attention_heads}

  sharing:
    shared: true

  dispatcher:
    _target_: tbfm.tbfm.SessionDispatcherTBFM

  # Learning parameters
  training:
    optim:
      lr_head: 4e-4
      lr_meta: 3e-3
      wd_head: 1e-4
      wd_meta: 1e-5
    lambda_fro: 45.0
    lambda_ortho: 0.00
